<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Three.JS: Source 24.53 Beta - Rendering Test</title>
<style>
  body { margin: 0; overflow: hidden; background: #0b0b0b; color: #e0e0e0; font-family: monospace; }
  #overlay { position: absolute; top: 10px; left: 10px; z-index: 10; }
  #fps { margin-bottom: 5px; }
  #console { background: rgba(0,0,0,0.7); padding: 5px; display: none; max-height: 200px; overflow-y: auto; }
  #input { width: 100%; box-sizing: border-box; background: #111; color: #fff; border: none; padding: 5px; }
  #menu { display: none; position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(20,20,20,0.95); z-index:20; color:#f0c674; text-align:center; padding-top:100px; font-size:2em;}
  button { padding: 10px 20px; font-size: 1em; cursor: pointer; margin-top:5px; }
</style>
</head>
<body>

<div id="overlay">
  <button id="startBtn">START RENDERING TEST</button>
  <div id="fps">FPS: 0</div>
  <div id="console"></div>
  <input type="text" id="input" placeholder="Console Command" />
</div>
<div id="menu">PAUSED - PRESS ESC TO RESUME</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.0/build/three.min.js"></script>
<script
let scene, camera, renderer;
let cubes = [], spheres = [];
let lastFrame = performance.now();
let fpsDisplay = document.getElementById('fps');
let consoleDiv = document.getElementById('console');
let input = document.getElementById('input');
let sv_cheats = 0;
let menu = document.getElementById('menu');
let paused = false;

// Basic Three.js setup
function initScene() {
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 100);
    camera.position.z = 5;
    renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Lighting
    const light = new THREE.PointLight(0xffffff, 1);
    light.position.set(5,5,5);
    scene.add(light);

    // Predefined cubes and spheres
    for(let i=0;i<5;i++){
        const cube = new THREE.Mesh(
            new THREE.BoxGeometry(),
            new THREE.MeshStandardMaterial({color: 0xff0000, emissive: 0x330000})
        );
        cube.position.x = Math.random()*4-2;
        cube.position.y = Math.random()*4-2;
        scene.add(cube);
        cubes.push(cube);

        const sphere = new THREE.Mesh(
            new THREE.SphereGeometry(0.5,16,16),
            new THREE.MeshStandardMaterial({color: 0x00ff00, emissive: 0x003300})
        );
        sphere.position.x = Math.random()*4-2;
        sphere.position.y = Math.random()*4-2;
        scene.add(sphere);
        spheres.push(sphere);
    }

    animate();
}

// Simulate broken code
function buggyFunction() {
    try {
        nonexistentFunctionCall(); // this will throw an error
    } catch(e) {
        appendConsole("Emily's chaos broke something: " + e.message);
    }
}

// FPS counter
function updateFPS() {
    let now = performance.now();
    let fps = Math.round(1000 / (now - lastFrame));
    lastFrame = now;
    fpsDisplay.textContent = "FPS: " + fps;
}

// Animate cubes and spheres
function animate() {
    if(paused) return;
    requestAnimationFrame(animate);
    updateFPS();

    cubes.forEach((c,i)=> {
        cube = cubes[i];
        cube.rotation.x += 0.01;
        cube.rotation.y += 0.01;
        cube.position.y += Math.sin(performance.now()*0.001+i*0.5)*0.001; // small oscillation
    });

    spheres.forEach((s,i)=> {
        sphere = spheres[i];
        sphere.rotation.y += 0.02;
        sphere.position.x += Math.sin(performance.now()*0.001+i*0.5)*0.001;
    });

    buggyFunction(); // intentionally broken call

    renderer.render(scene, camera);
}

// Console functions
function appendConsole(text){
    let p = document.createElement('p');
    p.textContent = text;
    consoleDiv.appendChild(p);
    consoleDiv.scrollTop = consoleDiv.scrollHeight;
}

input.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter'){
        let cmd = input.value.trim();
        input.value = '';
        appendConsole("> " + cmd);
        if(cmd === "sv_cheats 1"){
            sv_cheats = 1;
            appendConsole("Server char sv_cheats changed to 1");
        } else if(cmd === "sv_cheats 0"){
            sv_cheats = 0;
            appendConsole("Server char sv_cheats changed to 0");
        } else {
            appendConsole("Unknown command: " + cmd);
        }
    }
});

// ESC menu toggle
document.addEventListener('keydown',(e)=>{
    if(e.key === 'Escape'){
        paused = !paused;
        menu.style.display = paused ? "block" : "none";
        if(!paused) animate();
    }
});

// Start button
document.getElementById('startBtn').addEventListener('click', ()=>{
    initScene();
    document.getElementById('startBtn').disabled = true;
    appendConsole("Rendering test started. Emily is probably in trouble...");
});
</script>

</body>
</html>
