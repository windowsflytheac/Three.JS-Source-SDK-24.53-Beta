<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Three.JS-Source-SDK-24.53-Beta Ultimate Chaos</title>
<style>
body{margin:0;overflow:hidden;background:#0b0b0b;color:#e0e0e0;font-family:monospace;}
#overlay{position:absolute;top:10px;left:10px;z-index:50;background:rgba(0,0,0,0.5);padding:5px;width:300px;}
#fps{font-weight:bold;}
#console{display:block;max-height:200px;overflow-y:auto;font-size:12px;background:rgba(0,0,0,0.7);padding:5px;margin-top:5px;}
#input{width:100%;margin-top:3px;}
#menu{display:none;position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(20,20,20,0.95);z-index:60;color:#f0c674;text-align:center;padding-top:100px;font-size:2em;}
#tv{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;mix-blend-mode:screen;z-index:40;}
button{padding:10px 20px;font-size:1em;cursor:pointer;margin-top:5px;}
</style>
</head>
<body>

<div id="overlay">
  <button id="startBtn">START RENDERING TEST</button>
  <div id="fps">FPS: 0</div>
  <div id="console"></div>
  <input type="text" id="input" placeholder="Console Command" />
</div>
<div id="menu">PAUSED - PRESS ESC TO RESUME</div>
<canvas id="tv"></canvas>
<audio id="staticAudio" loop autoplay src="https://www.soundjay.com/mechanical/sounds/static-01.mp3"></audio>

<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.152.0/build/three.module.js';

let scene,camera,renderer;
let cubes=[],spheres=[];
let lastFrame=performance.now();
let fpsDisplay=document.getElementById('fps');
let consoleDiv=document.getElementById('console');
let input=document.getElementById('input');
let sv_cheats=0;
let menu=document.getElementById('menu');
let paused=false;

let tvCanvas=document.getElementById('tv');
let tvCtx=tvCanvas.getContext('2d');
tvCanvas.width=window.innerWidth;
tvCanvas.height=window.innerHeight;

// TV Snow + Scanlines + Flicker
function drawTV(){
    tvCtx.clearRect(0,0,tvCanvas.width,tvCanvas.height);
    for(let i=0;i<1000;i++){
        let x=Math.random()*tvCanvas.width;
        let y=Math.random()*tvCanvas.height;
        tvCtx.fillStyle='rgba(255,255,255,'+(0.05+Math.random()*0.05)+')';
        tvCtx.fillRect(x,y,1,1);
    }
    // scanlines
    tvCtx.strokeStyle='rgba(255,255,255,0.02)';
    for(let y=0;y<tvCanvas.height;y+=2){
        tvCtx.beginPath();
        tvCtx.moveTo(0,y);
        tvCtx.lineTo(tvCanvas.width,y);
        tvCtx.stroke();
    }
}

// Initialize scene
function initScene(){
    scene=new THREE.Scene();
    camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,100);
    camera.position.z=5;
    renderer=new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth,window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const light=new THREE.PointLight(0xffffff,1);
    light.position.set(5,5,5);
    scene.add(light);

    // Cubes and Spheres
    for(let i=0;i<5;i++){
        let cube=new THREE.Mesh(
            new THREE.BoxGeometry(),
            new THREE.MeshStandardMaterial({color:0xff0000,emissive:0x330000})
        );
        cube.position.set(Math.random()*4-2,Math.random()*4-2,Math.random()*4-2);
        scene.add(cube);
        cubes.push(cube);

        let sphere=new THREE.Mesh(
            new THREE.SphereGeometry(0.5,16,16),
            new THREE.MeshStandardMaterial({color:0x00ff00,emissive:0x003300})
        );
        sphere.position.set(Math.random()*4-2,Math.random()*4-2,Math.random()*4-2);
        scene.add(sphere);
        spheres.push(sphere);
    }

    animate();
}

// Chaotic function
function buggyFunction(){
    try{ nonexistentFunctionCall(); } 
    catch(e){ appendConsole("Emily's chaos broke something: "+e.message); }
}

// FPS counter
function updateFPS(){
    let now=performance.now();
    let fps=Math.round(1000/(now-lastFrame));
    lastFrame=now;
    fpsDisplay.textContent="FPS: "+fps;
}

// Animate
function animate(){
    if(paused) return;
    requestAnimationFrame(animate);
    updateFPS();

    // Glitches
    cubes.forEach((c,i)=>{
        c.rotation.x+=0.05*(Math.random()-0.5);
        c.rotation.y+=0.05*(Math.random()-0.5);
        c.position.x+=0.05*(Math.random()-0.5);
        c.position.y+=0.05*(Math.random()-0.5);
        c.material.color.offsetHSL(0.01*(Math.random()-0.5),0,0);
    });

    spheres.forEach((s,i)=>{
        s.rotation.x+=0.05*(Math.random()-0.5);
        s.rotation.y+=0.05*(Math.random()-0.5);
        s.position.x+=0.05*(Math.random()-0.5);
        s.position.y+=0.05*(Math.random()-0.5);
        s.material.color.offsetHSL(0.01*(Math.random()-0.5),0,0);
    });

    // Camera shake
    camera.position.x=Math.sin(performance.now()*0.003)*0.1;
    camera.position.y=Math.sin(performance.now()*0.0025)*0.1;

    buggyFunction();
    renderer.render(scene,camera);
    drawTV();
}

// Console logging
function appendConsole(text){
    let p=document.createElement('p');
    p.textContent=text;
    consoleDiv.appendChild(p);
    consoleDiv.scrollTop=consoleDiv.scrollHeight;
}

// Input
input.addEventListener('keydown',(e)=>{
    if(e.key==='Enter'){
        let cmd=input.value.trim(); input.value='';
        appendConsole("> "+cmd);
        if(cmd==="sv_cheats 1"){ sv_cheats=1; appendConsole("Server char sv_cheats changed to 1"); }
        else if(cmd==="sv_cheats 0"){ sv_cheats=0; appendConsole("Server char sv_cheats changed to 0"); }
        else appendConsole("Unknown command: "+cmd);
    }
});

// ESC menu
document.addEventListener('keydown',(e)=>{
    if(e.key==='Escape'){
        paused=!paused;
        menu.style.display=paused?"block":"none";
        if(!paused) animate();
    }
});

// Toggle console
document.addEventListener('keydown',e=>{
    if(e.key==='`'){ // backtick
        consoleDiv.style.display = consoleDiv.style.display==='block'?'none':'block';
    }
});

// Start
document.getElementById('startBtn').addEventListener('click',()=>{
    initScene();
    document.getElementById('startBtn').disabled=true;
    appendConsole("Rendering test started. Emily is probably in trouble...");
});
</script>
</body>
</html>
