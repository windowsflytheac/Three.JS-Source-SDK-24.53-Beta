<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Three.JS: Source 24.53 Beta</title>
<style>
body { margin:0; overflow:hidden; background:#000; font-family:sans-serif; }
#menu { position:absolute; top:0; left:0; right:0; text-align:center; color:white; background:rgba(0,0,0,0.7); display:none; padding:10px; z-index:1000; }
#fps { position:absolute; top:0; right:0; color:white; padding:5px; z-index:1000; font-family:monospace; }
#subtitle { position:absolute; bottom:10%; width:100%; text-align:center; color:#ff0; font-size:24px; font-family:monospace; text-shadow:1px 1px 2px #000; }
#selector { position:absolute; top:50px; left:10px; color:white; z-index:1000; }
button { display:block; margin:5px 0; }
</style>
</head>
<body>
<div id="menu">PAUSED - PRESS ESC TO RESUME</div>
<div id="fps">FPS: 0</div>
<div id="subtitle"></div>
<div id="selector">
  <button onclick="switchScene('renderTest')">Rendering Test</button>
  <button onclick="switchScene('seriousRoom')">Serious Room</button>
</div>

<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.152.0/build/three.module.js';

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const clock = new THREE.Clock();
const menu = document.getElementById('menu');
const fpsCounter = document.getElementById('fps');
const subtitle = document.getElementById('subtitle');

let keys = {};
let heldObject = null;

document.addEventListener('keydown', e=>keys[e.key.toLowerCase()]=true);
document.addEventListener('keyup', e=>keys[e.key.toLowerCase()]=false);

function logConsole(text){ console.log(text); }
function showSubtitle(text){ subtitle.innerText=text; setTimeout(()=>{subtitle.innerText='';},1500); }

const scenes = {};

// --- Rendering Test Scene ---
scenes.renderTest = function(){
    scene.children = [];
    const ambient = new THREE.AmbientLight(0x333333);
    scene.add(ambient);
    const dirLight = new THREE.DirectionalLight(0xffffff, 0.5);
    dirLight.position.set(5,10,7);
    scene.add(dirLight);

    // Placeholder cubes/spheres/glow moving
    for(let i=0;i<10;i++){
        const cube = new THREE.Mesh(new THREE.BoxGeometry(), new THREE.MeshStandardMaterial({color:Math.random()*0xffffff, emissive:Math.random()*0xffffff, emissiveIntensity:0.5}));
        cube.position.set((Math.random()-0.5)*10,0.5,(Math.random()-0.5)*10);
        cube.userData = {velocity:new THREE.Vector3(Math.random()-0.5,0,Math.random()-0.5)};
        scene.add(cube);
    }
    for(let i=0;i<5;i++){
        const sphere = new THREE.Mesh(new THREE.SphereGeometry(0.5,16,16), new THREE.MeshStandardMaterial({color:Math.random()*0xffffff, emissive:Math.random()*0xffffff, emissiveIntensity:0.5}));
        sphere.position.set((Math.random()-0.5)*10,0.5,(Math.random()-0.5)*10);
        scene.add(sphere);
    }

    // Blocky GLaDOS placeholder
    const glados = new THREE.Mesh(new THREE.BoxGeometry(1,2,1), new THREE.MeshStandardMaterial({color:0xffff00, emissive:0xffff00, emissiveIntensity:0.8}));
    glados.position.set(0,1,0);
    scene.add(glados);

    // TV glitch plane
    const tvGeo = new THREE.PlaneGeometry(5,3);
    const tvMat = new THREE.MeshBasicMaterial({color:0xffffff});
    const tv = new THREE.Mesh(tvGeo, tvMat);
    tv.position.set(0,1.5,-4);
    scene.add(tv);

    logConsole("Rendering Test loaded. Emily is probably in trouble...");
};

// --- Serious Room Scene ---
scenes.seriousRoom = function() {
    scene.children = [];
    const floorSR = new THREE.Mesh(new THREE.PlaneGeometry(6,6), new THREE.MeshStandardMaterial({color:0x222222}));
    floorSR.rotation.x = -Math.PI/2; scene.add(floorSR);

    const walls = new THREE.Mesh(new THREE.BoxGeometry(6,3,6), new THREE.MeshStandardMaterial({color:0x111111, side:THREE.BackSide}));
    walls.position.y = 1.5; scene.add(walls);

    const spot = new THREE.SpotLight(0xffffff,1.5);
    spot.position.set(0,3,0); spot.angle=Math.PI/6; spot.penumbra=0.3; scene.add(spot);

    const amb = new THREE.AmbientLight(0x222222); scene.add(amb);

    // Placeholder cube
    const placeholderCube = new THREE.Mesh(new THREE.BoxGeometry(), new THREE.MeshStandardMaterial({color:0xff0000}));
    placeholderCube.position.set(0,0.5,0); scene.add(placeholderCube);

    logConsole("Serious Room loaded. Everything is extremely seriousâ€¦");
};

// Scene switcher
function switchScene(name){ if(scenes[name]) scenes[name](); }

// Floor
const floor = new THREE.Mesh(new THREE.PlaneGeometry(50,50), new THREE.MeshStandardMaterial({color:0x444444}));
floor.rotation.x=-Math.PI/2; scene.add(floor);

// Camera
camera.position.set(0,1.6,5);

// Animate
function animate(){
    requestAnimationFrame(animate);
    const dt = clock.getDelta();
    fpsCounter.innerText = "FPS: "+(1/dt).toFixed(0);

    // Movement
    const speed = 5;
    let forward=(keys['w']?-1:0)+(keys['s']?1:0);
    let right=(keys['a']?-1:0)+(keys['d']?1:0);
    camera.position.y+=keys[' ']?5*dt:0;

    const dir = new THREE.Vector3();
    camera.getWorldDirection(dir);
    dir.y=0; dir.normalize();
    camera.position.add(dir.clone().multiplyScalar(forward*speed*dt));
    const rightDir = new THREE.Vector3().crossVectors(camera.up, dir).normalize();
    camera.position.add(rightDir.multiplyScalar(right*speed*dt));

    // Update cubes movement
    scene.traverse(obj=>{
        if(obj.userData.velocity){
            obj.position.add(obj.userData.velocity.clone().multiplyScalar(dt));
        }
    });

    // Update held object
    if(heldObject){
        const holdPos = camera.position.clone().add(camera.getWorldDirection(new THREE.Vector3()).multiplyScalar(2));
        heldObject.position.lerp(holdPos,0.2);
    }

    renderer.render(scene,camera);
}
animate();

// Interactions
document.addEventListener('keydown', e=>{
    if(e.key==='e'){
        if(heldObject){
            showSubtitle("Dropped object");
            heldObject = null;
        }else{
            // pick nearest cube
            let nearest=null,dist=5;
            scene.traverse(obj=>{
                if(obj instanceof THREE.Mesh && obj.geometry instanceof THREE.BoxGeometry){
                    const d=obj.position.distanceTo(camera.position);
                    if(d<dist){ nearest=obj; dist=d; }
                }
            });
            if(nearest){ heldObject=nearest; showSubtitle("Picked up placeholder object"); }
            else showSubtitle("Can't Use");
        }
    }
    if(e.key==='q') showSubtitle("Spawn Menu Opened (placeholder)");
    if(e.key==='Escape') menu.style.display = menu.style.display==='none'?'block':'none';
    if(e.key==='1'){ logConsole("Server char sv_cheats changed to 1"); showSubtitle("sv_cheats set to 1"); }
    if(e.key==='0'){ logConsole("Server char sv_cheats changed to 0"); showSubtitle("sv_cheats set to 0"); }
});

// Start with Rendering Test
switchScene('renderTest');
</script>
</body>
</html>
