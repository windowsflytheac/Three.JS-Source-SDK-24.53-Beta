<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Three.JS-Source-SDK-24.53-Beta Ultimate Chaos</title>
<style>
body{margin:0;overflow:hidden;background:#0b0b0b;color:#e0e0e0;font-family:monospace;}
#overlay{position:absolute;top:10px;left:10px;z-index:50;background:rgba(0,0,0,0.5);padding:5px;width:300px;}
#fps{font-weight:bold;}
#console{display:block;max-height:200px;overflow-y:auto;font-size:12px;background:rgba(0,0,0,0.7);padding:5px;margin-top:5px;}
#input{width:100%;margin-top:3px;}
#menu{display:none;position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(20,20,20,0.95);z-index:60;color:#f0c674;text-align:center;padding-top:100px;font-size:2em;}
#tv{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;mix-blend-mode:screen;z-index:40;}
button{padding:10px 20px;font-size:1em;cursor:pointer;margin-top:5px;}
</style>
</head>
<body>

<div id="overlay">
  <button id="startBtn">START RENDERING TEST</button>
  <div id="fps">FPS: 0</div>
  <div id="console"></div>
  <input type="text" id="input" placeholder="Console Command" />
</div>
<div id="menu">PAUSED - PRESS ESC TO RESUME</div>
<canvas id="tv"></canvas>
<audio id="staticAudio" loop autoplay src="https://www.soundjay.com/mechanical/sounds/static-01.mp3"></audio>

<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.152.0/build/three.module.js';

let scene, camera, renderer;
let cubes=[], spheres=[];
let fpsDisplay=document.getElementById('fps');
let consoleDiv=document.getElementById('console');
let paused=false;
let menu=document.getElementById('menu');
let chaosCounter = 0;

function appendConsole(text){
    let p=document.createElement('p');
    p.textContent=text;
    consoleDiv.appendChild(p);
    consoleDiv.scrollTop=consoleDiv.scrollHeight;
}

// Initialize scene
function initScene(){
    scene=new THREE.Scene();
    camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,100);
    camera.position.z=5;
    renderer=new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth,window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const light=new THREE.PointLight(0xffffff,1);
    light.position.set(5,5,5);
    scene.add(light);

    // Chaos cubes & spheres
    for(let i=0;i<5;i++){
        let cube=new THREE.Mesh(new THREE.BoxGeometry(), new THREE.MeshStandardMaterial({color:0xff0000,emissive:0x330000}));
        cube.position.set(Math.random()*4-2, Math.random()*4-2, Math.random()*4-2);
        scene.add(cube); cubes.push(cube);

        let sphere=new THREE.Mesh(new THREE.SphereGeometry(0.5,16,16), new THREE.MeshStandardMaterial({color:0x00ff00,emissive:0x003300}));
        sphere.position.set(Math.random()*4-2, Math.random()*4-2, Math.random()*4-2);
        scene.add(sphere); spheres.push(sphere);
    }

    // Blocky GLaDOS
    let glados = new THREE.Group();

    // Eye
    let eye = new THREE.Mesh(
        new THREE.SphereGeometry(0.3,16,16),
        new THREE.MeshStandardMaterial({color:0xffff00, emissive:0x333300})
    );
    eye.position.set(0,1.5,0);
    glados.add(eye);

    // Body - stacked cubes
    for(let y=0; y<3; y++){
        let block = new THREE.Mesh(
            new THREE.BoxGeometry(0.5,0.5,0.5),
            new THREE.MeshStandardMaterial({color:0x666666})
        );
        block.position.set(0, y*0.5,0);
        glados.add(block);
    }

    glados.position.set(0,0,0);
    scene.add(glados);

    // Animate
    function animate(){
        if(paused) return;
        requestAnimationFrame(animate);

        // FPS counter
        fpsDisplay.textContent="FPS: "+Math.round(1000/performance.now());

        // Chaotic cube/sphere movement
        cubes.forEach(c=>{
            c.rotation.x+=0.05*(Math.random()-0.5);
            c.rotation.y+=0.05*(Math.random()-0.5);
            c.position.x+=0.05*(Math.random()-0.5);
            c.position.y+=0.05*(Math.random()-0.5);
        });
        spheres.forEach(s=>{
            s.rotation.x+=0.05*(Math.random()-0.5);
            s.rotation.y+=0.05*(Math.random()-0.5);
            s.position.x+=0.05*(Math.random()-0.5);
            s.position.y+=0.05*(Math.random()-0.5);
        });

        // Eye follows camera horizontally
        eye.position.x = THREE.MathUtils.lerp(eye.position.x, camera.position.x*0.2, 0.05);

        renderer.render(scene,camera);
    }
    animate();
}

// ESC menu
document.addEventListener('keydown',(e)=>{
    if(e.key==='Escape'){ paused=!paused; menu.style.display=paused?"block":"none"; if(!paused)initScene();}
});

document.getElementById('startBtn').addEventListener('click',()=>{
    initScene();
    appendConsole("Rendering test started. Emily is probably in trouble...");
    document.getElementById('startBtn').disabled=true;
});
</script>
